# Developer Documentation

## Adding New Backends

### Generating API Bindings

We use the [openapi-generator](https://github.com/OpenAPITools/openapi-generator) to generate the rust bindings consumed by doplarr.
This is installed in the nix development shell.

Use the following command to generate the library (shown here for Radarr)

```sh
openapi-generator-cli generate \
    --package-name "sonarr_api" \
    -g rust \
    -i sonarr_v3.json \
    -o sonarr_api 
```

Then, add that library to the `Cargo.toml` workspace members, and the dependency in the `doplarr` source.
You can also remove the autogenerated `git_push.sh`, `docs` folder, `.travis.yml`, `.openapi-generator` folder, `.gitignore`, and `.openapi-generator-ignore`, as we don't need those, leaving only `src` and `Cargo.toml`.

In some cases, manual edits to the generated files are required because the generator isn't perfect (sorry!).
The rust compiler output is helpful here.
In most cases, you can just remove the offending endpoints if they are unused.

Then, add that library to doplarr's Config.toml under backend APIs.

### Adding Implementations

Under `doplarr/src/providers` add your backend file and add to the `mod.rs`.
Follow the other backends as an example, implementing the `MediaBackend` and `MediaItem` traits.

### Add Config Settings

In `doplarr/src/config.rs`, add the appropriate configuration settings for use in the config file.

### Add Initialization

In `doplarr/src/main.rs`, update the `let mut backends = HashMap::new() ...` section to match the new config type, mapping to your constructor.
